"use strict";(self.webpackChunktetu_game_ui=self.webpackChunktetu_game_ui||[]).push([[517],{42222:(V,A,v)=>{v.r(A),v.d(A,{AlchemyWebSocketProvider:()=>se});var r=v(11945),L=v(66967),B=v(61611),x=v(29883),T=v(31269),H=v(77262),_=v(79831),l=v(88649);let i=null;try{if(i=WebSocket,null==i)throw new Error("inject please")}catch{const e=new _.Yd(l.i);i=function(){e.throwError("WebSockets not supported in this environment",_.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new WebSocket()"})}}var c=function(a,e,t,s){return new(t||(t=Promise))(function(o,u){function d(y){try{b(s.next(y))}catch(m){u(m)}}function f(y){try{b(s.throw(y))}catch(m){u(m)}}function b(y){y.done?o(y.value):function n(o){return o instanceof t?o:new t(function(u){u(o)})}(y.value).then(d,f)}b((s=s.apply(a,e||[])).next())})};const h=new _.Yd(l.i);let k=1;class I extends H.r{constructor(e,t){"any"===t&&h.throwError("WebSocketProvider does not support 'any' network yet",_.Yd.errors.UNSUPPORTED_OPERATION,{operation:"network:any"}),super("string"==typeof e?e:"_websocket",t),this._pollingInterval=-1,this._wsReady=!1,(0,T.zG)(this,"_websocket","string"==typeof e?new i(this.connection.url):e),(0,T.zG)(this,"_requests",{}),(0,T.zG)(this,"_subs",{}),(0,T.zG)(this,"_subIds",{}),(0,T.zG)(this,"_detectNetwork",super.detectNetwork()),this.websocket.onopen=()=>{this._wsReady=!0,Object.keys(this._requests).forEach(n=>{this.websocket.send(this._requests[n].payload)})},this.websocket.onmessage=n=>{const o=n.data,u=JSON.parse(o);if(null!=u.id){const d=String(u.id),f=this._requests[d];if(delete this._requests[d],void 0!==u.result)f.callback(null,u.result),this.emit("debug",{action:"response",request:JSON.parse(f.payload),response:u.result,provider:this});else{let b=null;u.error?(b=new Error(u.error.message||"unknown error"),(0,T.zG)(b,"code",u.error.code||null),(0,T.zG)(b,"response",o)):b=new Error("unknown error"),f.callback(b,void 0),this.emit("debug",{action:"response",error:b,request:JSON.parse(f.payload),provider:this})}}else if("eth_subscription"===u.method){const d=this._subs[u.params.subscription];d&&d.processFunc(u.params.result)}else console.warn("this should not happen")};const s=setInterval(()=>{this.emit("poll")},1e3);s.unref&&s.unref()}get websocket(){return this._websocket}detectNetwork(){return this._detectNetwork}get pollingInterval(){return 0}resetEventsBlock(e){h.throwError("cannot reset events block on WebSocketProvider",_.Yd.errors.UNSUPPORTED_OPERATION,{operation:"resetEventBlock"})}set pollingInterval(e){h.throwError("cannot set polling interval on WebSocketProvider",_.Yd.errors.UNSUPPORTED_OPERATION,{operation:"setPollingInterval"})}poll(){return c(this,void 0,void 0,function*(){return null})}set polling(e){!e||h.throwError("cannot set polling on WebSocketProvider",_.Yd.errors.UNSUPPORTED_OPERATION,{operation:"setPolling"})}send(e,t){const s=k++;return new Promise((n,o)=>{const d=JSON.stringify({method:e,params:t,id:s,jsonrpc:"2.0"});this.emit("debug",{action:"request",request:JSON.parse(d),provider:this}),this._requests[String(s)]={callback:function u(f,b){return f?o(f):n(b)},payload:d},this._wsReady&&this.websocket.send(d)})}static defaultUrl(){return"ws://localhost:8546"}_subscribe(e,t,s){return c(this,void 0,void 0,function*(){let n=this._subIds[e];null==n&&(n=Promise.all(t).then(u=>this.send("eth_subscribe",u)),this._subIds[e]=n);const o=yield n;this._subs[o]={tag:e,processFunc:s}})}_startEvent(e){switch(e.type){case"block":this._subscribe("block",["newHeads"],t=>{const s=B.O$.from(t.number).toNumber();this._emitted.block=s,this.emit("block",s)});break;case"pending":this._subscribe("pending",["newPendingTransactions"],t=>{this.emit("pending",t)});break;case"filter":this._subscribe(e.tag,["logs",this._getFilter(e.filter)],t=>{null==t.removed&&(t.removed=!1),this.emit(e.filter,this.formatter.filterLog(t))});break;case"tx":{const t=s=>{const n=s.hash;this.getTransactionReceipt(n).then(o=>{!o||this.emit(n,o)})};t(e),this._subscribe("tx",["newHeads"],s=>{this._events.filter(n=>"tx"===n.type).forEach(t)});break}case"debug":case"poll":case"willPoll":case"didPoll":case"error":break;default:console.log("unhandled:",e)}}_stopEvent(e){let t=e.tag;if("tx"===e.type){if(this._events.filter(n=>"tx"===n.type).length)return;t="tx"}else if(this.listenerCount(e.event))return;const s=this._subIds[t];!s||(delete this._subIds[t],s.then(n=>{!this._subs[n]||(delete this._subs[n],this.send("eth_unsubscribe",[n]))}))}destroy(){return c(this,void 0,void 0,function*(){this.websocket.readyState===i.CONNECTING&&(yield new Promise(e=>{this.websocket.onopen=function(){e(!0)},this.websocket.onerror=function(){e(!1)}})),this.websocket.close(1e3)})}}var p=v(53562);v(65827);class J{constructor(e){this.provider=e,this.maxBackfillBlocks=120}getNewHeadsBackfill(e,t,s){return(0,r._)(this,void 0,void 0,function*(){w(e);const n=yield this.getBlockNumber();if(w(e),0===t.length)return this.getHeadEventsInRange(Math.max(s,n-this.maxBackfillBlocks)+1,n+1);const o=(0,r.f)(t[t.length-1].number),u=n-this.maxBackfillBlocks+1;if(o<=u)return this.getHeadEventsInRange(u,n+1);const d=yield this.getReorgHeads(e,t);w(e);const f=yield this.getHeadEventsInRange(o+1,n+1);return w(e),[...d,...f]})}getLogsBackfill(e,t,s,n){return(0,r._)(this,void 0,void 0,function*(){w(e);const o=yield this.getBlockNumber();if(w(e),0===s.length)return this.getLogsInRange(t,Math.max(n,o-this.maxBackfillBlocks)+1,o+1);const u=(0,r.f)(s[s.length-1].blockNumber),d=o-this.maxBackfillBlocks+1;if(u<d)return this.getLogsInRange(t,d,o+1);const f=yield this.getCommonAncestor(e,s);w(e);const b=s.filter(g=>(0,r.f)(g.blockNumber)>f.blockNumber).map(g=>Object.assign(Object.assign({},g),{removed:!0})),y=f.blockNumber===Number.NEGATIVE_INFINITY?(0,r.f)(s[0].blockNumber):f.blockNumber;let m=yield this.getLogsInRange(t,y,o+1);return m=m.filter(g=>g&&((0,r.f)(g.blockNumber)>f.blockNumber||(0,r.f)(g.logIndex)>f.logIndex)),w(e),[...b,...m]})}setMaxBackfillBlock(e){this.maxBackfillBlocks=e}getBlockNumber(){return(0,r._)(this,void 0,void 0,function*(){const e=yield this.provider.send("eth_blockNumber");return(0,r.f)(e)})}getHeadEventsInRange(e,t){return(0,r._)(this,void 0,void 0,function*(){if(e>=t)return[];const s=[];for(let o=e;o<t;o++)s.push({method:"eth_getBlockByNumber",params:[(0,r.t)(o),!1]});return(yield this.provider.sendBatch(s)).map(j)})}getReorgHeads(e,t){return(0,r._)(this,void 0,void 0,function*(){const s=[];for(let n=t.length-1;n>=0;n--){const o=t[n],u=yield this.getBlockByNumber((0,r.f)(o.number));if(w(e),o.hash===u.hash)break;s.push(j(u))}return s.reverse()})}getBlockByNumber(e){return(0,r._)(this,void 0,void 0,function*(){return this.provider.send("eth_getBlockByNumber",[(0,r.t)(e),!1])})}getCommonAncestor(e,t){return(0,r._)(this,void 0,void 0,function*(){let s=yield this.getBlockByNumber((0,r.f)(t[t.length-1].blockNumber));w(e);for(let n=t.length-1;n>=0;n--){const o=t[n];if(o.blockNumber!==s.number&&(s=yield this.getBlockByNumber((0,r.f)(o.blockNumber))),o.blockHash===s.hash)return{blockNumber:(0,r.f)(o.blockNumber),logIndex:(0,r.f)(o.logIndex)}}return{blockNumber:Number.NEGATIVE_INFINITY,logIndex:Number.NEGATIVE_INFINITY}})}getLogsInRange(e,t,s){return(0,r._)(this,void 0,void 0,function*(){if(t>=s)return[];const n=Object.assign(Object.assign({},e),{fromBlock:(0,r.t)(t),toBlock:(0,r.t)(s-1)});return this.provider.send("eth_getLogs",[n])})}}function j(a){const e=Object.assign({},a);return delete e.totalDifficulty,delete e.transactions,delete e.uncles,e}function U(a,e){const t=new Set,s=[];return a.forEach(n=>{const o=e(n);t.has(o)||(t.add(o),s.push(n))}),s}const Q=new Error("Cancelled");function w(a){if(a())throw Q}class se extends I{constructor(e,t){var s;const n=p.AlchemyProvider.getApiKey(e.apiKey),o=p.AlchemyProvider.getAlchemyNetwork(e.network),u=p.AlchemyProvider.getAlchemyConnectionInfo(o,n,"wss");super(new L.Z(null!==(s=e.url)&&void 0!==s?s:u.url,`alchemy-sdk-${r.V}`,{wsConstructor:t??(typeof process<"u"&&null!=process&&null!=process.versions&&null!=process.versions.node?v(67620).w3cwebsocket:WebSocket)}),r.E[o]),this._events=[],this.virtualSubscriptionsById=new Map,this.virtualIdsByPhysicalId=new Map,this.handleMessage=y=>{const m=JSON.parse(y.data);if(!function he(a){return!function ae(a){return Array.isArray(a)||"2.0"===a.jsonrpc&&void 0!==a.id}(a)}(m))return;const g=m.params.subscription,E=this.virtualIdsByPhysicalId.get(g);if(!E)return;const P=this.virtualSubscriptionsById.get(E);if("eth_subscribe"===P.method)switch(P.params[0]){case"newHeads":{const S=P,D=m,{isBackfilling:M,backfillBuffer:G}=S,{result:N}=D.params;M?function de(a,e){W(a,e,C)}(G,N):g!==E?this.emitAndRememberEvent(E,N,C):this.rememberEvent(E,N,C);break}case"logs":{const S=P,D=m,{isBackfilling:M,backfillBuffer:G}=S,{result:N}=D.params;M?function fe(a,e){W(a,e,O)}(G,N):E!==g?this.emitAndRememberEvent(E,N,O):this.rememberEvent(E,N,O);break}default:if(g!==E){const{result:S}=m.params;this.emitEvent(E,S)}}},this.handleReopen=()=>{this.virtualIdsByPhysicalId.clear();const{cancel:y,isCancelled:m}=function re(){let a=!1;return{cancel:()=>a=!0,isCancelled:()=>a}}();this.cancelBackfill=y;for(const g of this.virtualSubscriptionsById.values())(0,r._)(this,void 0,void 0,function*(){try{yield this.resubscribeAndBackfill(m,g)}catch(E){m()||console.error(`Error while backfilling "${g.params[0]}" subscription. Some events may be missing.`,E)}});this.startHeartbeat()},this.stopHeartbeatAndBackfill=()=>{null!=this.heartbeatIntervalId&&(clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=void 0),this.cancelBackfill()},this.apiKey=n,this.backfiller=new J(this),this.addSocketListeners(),this.startHeartbeat(),this.cancelBackfill=r.n}static getNetwork(e){return"string"==typeof e&&e in r.C?r.C[e]:(0,x.H)(e)}on(e,t){return this._addEventListener(e,t,!1)}once(e,t){return this._addEventListener(e,t,!0)}off(e,t){return(0,r.i)(e)?this._off(e,t):super.off(e,t)}removeAllListeners(e){return void 0!==e&&(0,r.i)(e)?this._removeAllListeners(e):super.removeAllListeners(e)}listenerCount(e){return void 0!==e&&(0,r.i)(e)?this._listenerCount(e):super.listenerCount(e)}listeners(e){return void 0!==e&&(0,r.i)(e)?this._listeners(e):super.listeners(e)}_addEventListener(e,t,s){if((0,r.i)(e)){(0,r.v)(e);const n=new r.c((0,r.e)(e),t,s);return this._events.push(n),this._startEvent(n),this}return super._addEventListener(e,t,s)}_startEvent(e){[...r.A,"block","filter"].includes(e.type)?this.customStartEvent(e):super._startEvent(e)}_subscribe(e,t,s,n){return(0,r._)(this,void 0,void 0,function*(){let o=this._subIds[e];const u=yield this.getBlockNumber();null==o&&(o=Promise.all(t).then(b=>this.send("eth_subscribe",b)),this._subIds[e]=o);const d=yield o,f=yield Promise.all(t);this.virtualSubscriptionsById.set(d,{event:n,method:"eth_subscribe",params:f,startingBlockNumber:u,virtualId:d,physicalId:d,sentEvents:[],isBackfilling:!1,backfillBuffer:[]}),this.virtualIdsByPhysicalId.set(d,d),this._subs[d]={tag:e,processFunc:s}})}emit(e,...t){if((0,r.i)(e)){let s=!1;const n=[],o=(0,r.e)(e);return this._events=this._events.filter(u=>u.tag!==o||(setTimeout(()=>{u.listener.apply(this,t)},0),s=!0,!u.once||(n.push(u),!1))),n.forEach(u=>{this._stopEvent(u)}),s}return super.emit(e,...t)}sendBatch(e){return(0,r._)(this,void 0,void 0,function*(){let t=0;const s=e.map(({method:n,params:o})=>({method:n,params:o,jsonrpc:"2.0",id:"alchemy-sdk:"+t++}));return this.sendBatchConcurrently(s)})}destroy(){return this.removeSocketListeners(),this.stopHeartbeatAndBackfill(),super.destroy()}isCommunityResource(){return this.apiKey===r.D}_stopEvent(e){let t=e.tag;if(r.A.includes(e.type)){if(this._events.filter(n=>r.A.includes(n.type)).length)return}else if("tx"===e.type){if(this._events.filter(n=>"tx"===n.type).length)return;t="tx"}else if(this.listenerCount(e.event))return;const s=this._subIds[t];!s||(delete this._subIds[t],s.then(n=>{!this._subs[n]||(delete this._subs[n],this.send("eth_unsubscribe",[n]))}))}addSocketListeners(){this._websocket.addEventListener("message",this.handleMessage),this._websocket.addEventListener("reopen",this.handleReopen),this._websocket.addEventListener("down",this.stopHeartbeatAndBackfill)}removeSocketListeners(){this._websocket.removeEventListener("message",this.handleMessage),this._websocket.removeEventListener("reopen",this.handleReopen),this._websocket.removeEventListener("down",this.stopHeartbeatAndBackfill)}resubscribeAndBackfill(e,t){return(0,r._)(this,void 0,void 0,function*(){const{virtualId:s,method:n,params:o,sentEvents:u,backfillBuffer:d,startingBlockNumber:f}=t;t.isBackfilling=!0,d.length=0;try{const b=yield this.send(n,o);switch(w(e),t.physicalId=b,this.virtualIdsByPhysicalId.set(b,s),o[0]){case"newHeads":{const y=yield z(()=>F(this.backfiller.getNewHeadsBackfill(e,u,f),6e4),5,()=>!e());w(e),function X(a){return U(a,e=>e.hash)}([...y,...d]).forEach(g=>this.emitNewHeadsEvent(s,g));break}case"logs":{const y=o[1]||{},m=yield z(()=>F(this.backfiller.getLogsBackfill(e,y,u,f),6e4),5,()=>!e());w(e),function Z(a){return U(a,e=>`${e.blockHash}/${e.logIndex}`)}([...m,...d]).forEach(E=>this.emitLogsEvent(s,E));break}}}finally{t.isBackfilling=!1,d.length=0}})}emitNewHeadsEvent(e,t){this.emitAndRememberEvent(e,t,C)}emitLogsEvent(e,t){this.emitAndRememberEvent(e,t,O)}emitAndRememberEvent(e,t,s){this.rememberEvent(e,t,s),this.emitEvent(e,t)}emitEvent(e,t){const s=this.virtualSubscriptionsById.get(e);!s||this.emitGenericEvent(s,t)}rememberEvent(e,t,s){const n=this.virtualSubscriptionsById.get(e);!n||W(n.sentEvents,Object.assign({},t),s)}emitGenericEvent(e,t){this.emitProcessFn(e.event)(t)}startHeartbeat(){null==this.heartbeatIntervalId&&(this.heartbeatIntervalId=setInterval(()=>(0,r._)(this,void 0,void 0,function*(){try{yield F(this.send("net_version"),1e4)}catch{this._websocket.reconnect()}}),3e4))}sendBatchConcurrently(e){return(0,r._)(this,void 0,void 0,function*(){return Promise.all(e.map(t=>this.send(t.method,t.params)))})}customStartEvent(e){if(e.type===r.h){const{fromAddress:t,toAddress:s,hashesOnly:n}=e;this._subscribe(e.tag,[r.j.PENDING_TRANSACTIONS,{fromAddress:t,toAddress:s,hashesOnly:n}],this.emitProcessFn(e),e)}else if(e.type===r.k){const{addresses:t,includeRemoved:s,hashesOnly:n}=e;this._subscribe(e.tag,[r.j.MINED_TRANSACTIONS,{addresses:t,includeRemoved:s,hashesOnly:n}],this.emitProcessFn(e),e)}else"block"===e.type?this._subscribe("block",["newHeads"],this.emitProcessFn(e),e):"filter"===e.type&&this._subscribe(e.tag,["logs",this._getFilter(e.filter)],this.emitProcessFn(e),e)}emitProcessFn(e){switch(e.type){case r.h:return t=>this.emit({method:r.j.PENDING_TRANSACTIONS,fromAddress:e.fromAddress,toAddress:e.toAddress,hashesOnly:e.hashesOnly},t);case r.k:return t=>this.emit({method:r.j.MINED_TRANSACTIONS,addresses:e.addresses,includeRemoved:e.includeRemoved,hashesOnly:e.hashesOnly},t);case"block":return t=>{const s=B.O$.from(t.number).toNumber();this._emitted.block=s,this.emit("block",s)};case"filter":return t=>{null==t.removed&&(t.removed=!1),this.emit(e.filter,this.formatter.filterLog(t))};default:throw new Error("Invalid event type to `emitProcessFn()`")}}_off(e,t){if(null==t)return this.removeAllListeners(e);const s=[];let n=!1;const o=(0,r.e)(e);return this._events=this._events.filter(u=>!(u.tag===o&&u.listener==t&&!n&&(n=!0,s.push(u),1))),s.forEach(u=>{this._stopEvent(u)}),this}_removeAllListeners(e){let t=[];if(null==e)t=this._events,this._events=[];else{const s=(0,r.e)(e);this._events=this._events.filter(n=>n.tag!==s||(t.push(n),!1))}return t.forEach(s=>{this._stopEvent(s)}),this}_listenerCount(e){if(!e)return this._events.length;const t=(0,r.e)(e);return this._events.filter(s=>s.tag===t).length}_listeners(e){if(null==e)return this._events.map(s=>s.listener);const t=(0,r.e)(e);return this._events.filter(s=>s.tag===t).map(s=>s.listener)}}function z(a,e,t=(()=>!0)){return(0,r._)(this,void 0,void 0,function*(){let s=0,n=0;for(;;)try{return yield a()}catch(o){if(n++,n>=e||!t(o)||(yield ue(s),!t(o)))throw o;s=0===s?1e3:Math.min(3e4,2*s)}})}function ue(a){return new Promise(e=>setTimeout(e,a))}function F(a,e){return Promise.race([a,new Promise((t,s)=>setTimeout(()=>s(new Error("Timeout")),e))])}function C(a){return(0,r.f)(a.number)}function O(a){return(0,r.f)(a.blockNumber)}function W(a,e,t){const s=t(e),n=a.findIndex(o=>t(o)>s-10);-1===n?a.length=0:a.splice(0,n),a.push(e)}},66967:(V,A)=>{var B=function(){function l(i,c,h){if(void 0===h&&(h={}),this.url=i,this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.ondown=null,this.onreopen=null,this.CONNECTING=l.CONNECTING,this.OPEN=l.OPEN,this.CLOSING=l.CLOSING,this.CLOSED=l.CLOSED,this.hasBeenOpened=!1,this.isClosed=!1,this.messageBuffer=[],this.nextRetryTime=0,this.reconnectCount=0,this.lastKnownExtensions="",this.lastKnownProtocol="",this.listeners={},null==c||"string"==typeof c||Array.isArray(c)?this.protocols=c:h=c,this.options=function x(l){var i={};return Object.keys(B.DEFAULT_OPTIONS).forEach(function(c){var h=l[c];i[c]=void 0===h?B.DEFAULT_OPTIONS[c]:h}),i}(h),!this.options.wsConstructor){if(!(typeof WebSocket<"u"))throw new Error("WebSocket not present in global scope and no wsConstructor option was provided.");this.options.wsConstructor=WebSocket}this.openNewWebSocket()}return Object.defineProperty(l.prototype,"binaryType",{get:function(){return this.binaryTypeInternal||"blob"},set:function(i){this.binaryTypeInternal=i,this.ws&&(this.ws.binaryType=i)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bufferedAmount",{get:function(){var i=this.ws?this.ws.bufferedAmount:0,c=!1;return this.messageBuffer.forEach(function(h){var k=function T(l){return"string"==typeof l?2*l.length:l instanceof ArrayBuffer?l.byteLength:l instanceof Blob?l.size:void 0}(h);null!=k?i+=k:c=!0}),c&&this.debugLog("Some buffered data had unknown length. bufferedAmount() return value may be below the correct amount."),i},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"extensions",{get:function(){return this.ws?this.ws.extensions:this.lastKnownExtensions},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"protocol",{get:function(){return this.ws?this.ws.protocol:this.lastKnownProtocol},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"readyState",{get:function(){return this.isClosed?l.CLOSED:l.OPEN},enumerable:!0,configurable:!0}),l.prototype.close=function(i,c){this.disposeSocket(i,c),this.shutdown(),this.debugLog("WebSocket permanently closed by client.")},l.prototype.send=function(i){if(this.isClosed)throw new Error("WebSocket is already in CLOSING or CLOSED state.");this.ws&&this.ws.readyState===this.OPEN?this.ws.send(i):this.messageBuffer.push(i)},l.prototype.reconnect=function(){if(this.isClosed)throw new Error("Cannot call reconnect() on socket which is permanently closed.");this.disposeSocket(1e3,"Client requested reconnect."),this.handleClose(void 0)},l.prototype.addEventListener=function(i,c){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(c)},l.prototype.dispatchEvent=function(i){return this.dispatchEventOfType(i.type,i)},l.prototype.removeEventListener=function(i,c){this.listeners[i]&&(this.listeners[i]=this.listeners[i].filter(function(h){return h!==c}))},l.prototype.openNewWebSocket=function(){var i=this;if(!this.isClosed){var c=this.options,h=c.connectTimeout,k=c.wsConstructor;this.debugLog("Opening new WebSocket to "+this.url+".");var I=new k(this.url,this.protocols);I.onclose=function(p){return i.handleClose(p)},I.onerror=function(p){return i.handleError(p)},I.onmessage=function(p){return i.handleMessage(p)},I.onopen=function(p){return i.handleOpen(p)},this.connectTimeoutId=setTimeout(function(){i.clearConnectTimeout(),i.disposeSocket(),i.handleClose(void 0)},h),this.ws=I}},l.prototype.handleOpen=function(i){var c=this;if(this.ws&&!this.isClosed){var h=this.options.allClearResetTime;this.debugLog("WebSocket opened."),null!=this.binaryTypeInternal?this.ws.binaryType=this.binaryTypeInternal:this.binaryTypeInternal=this.ws.binaryType,this.clearConnectTimeout(),this.hasBeenOpened?this.dispatchEventOfType("reopen",i):(this.dispatchEventOfType("open",i),this.hasBeenOpened=!0),this.messageBuffer.forEach(function(k){return c.send(k)}),this.messageBuffer=[],this.allClearTimeoutId=setTimeout(function(){c.clearAllClearTimeout(),c.nextRetryTime=0,c.reconnectCount=0,c.debugLog("WebSocket remained open for "+(h/1e3|0)+" seconds. Resetting retry time and count.")},h)}},l.prototype.handleMessage=function(i){this.isClosed||this.dispatchEventOfType("message",i)},l.prototype.handleClose=function(i){var c=this;if(!this.isClosed){var h=this.options,k=h.maxReconnectAttempts,I=h.shouldReconnect;if(this.clearConnectTimeout(),this.clearAllClearTimeout(),this.ws&&(this.lastKnownExtensions=this.ws.extensions,this.lastKnownProtocol=this.ws.protocol,this.disposeSocket()),this.dispatchEventOfType("down",i),this.reconnectCount>=k)return void this.stopReconnecting(i,this.getTooManyFailedReconnectsMessage());var p=!i||I(i);"boolean"==typeof p?this.handleWillReconnect(p,i,"Provided shouldReconnect() returned false. Closing permanently."):p.then(function(R){c.isClosed||c.handleWillReconnect(R,i,"Provided shouldReconnect() resolved to false. Closing permanently.")})}},l.prototype.handleError=function(i){this.dispatchEventOfType("error",i),this.debugLog("WebSocket encountered an error.")},l.prototype.handleWillReconnect=function(i,c,h){i?this.reestablishConnection():this.stopReconnecting(c,h)},l.prototype.reestablishConnection=function(){var i=this,c=this.options,h=c.minReconnectDelay,k=c.maxReconnectDelay,I=c.reconnectBackoffFactor;this.reconnectCount++;var p=this.nextRetryTime;this.nextRetryTime=Math.max(h,Math.min(this.nextRetryTime*I,k)),setTimeout(function(){return i.openNewWebSocket()},p),this.debugLog("WebSocket was closed. Re-opening in "+(p/1e3|0)+" seconds.")},l.prototype.stopReconnecting=function(i,c){this.debugLog(c),this.shutdown(),i&&this.dispatchEventOfType("close",i)},l.prototype.shutdown=function(){this.isClosed=!0,this.clearAllTimeouts(),this.messageBuffer=[],this.disposeSocket()},l.prototype.disposeSocket=function(i,c){!this.ws||(this.ws.onerror=_,this.ws.onclose=_,this.ws.onmessage=_,this.ws.onopen=_,this.ws.close(i,c),this.ws=void 0)},l.prototype.clearAllTimeouts=function(){this.clearConnectTimeout(),this.clearAllClearTimeout()},l.prototype.clearConnectTimeout=function(){null!=this.connectTimeoutId&&(clearTimeout(this.connectTimeoutId),this.connectTimeoutId=void 0)},l.prototype.clearAllClearTimeout=function(){null!=this.allClearTimeoutId&&(clearTimeout(this.allClearTimeoutId),this.allClearTimeoutId=void 0)},l.prototype.dispatchEventOfType=function(i,c){var h=this;switch(i){case"close":this.onclose&&this.onclose(c);break;case"error":this.onerror&&this.onerror(c);break;case"message":this.onmessage&&this.onmessage(c);break;case"open":this.onopen&&this.onopen(c);break;case"down":this.ondown&&this.ondown(c);break;case"reopen":this.onreopen&&this.onreopen(c)}return i in this.listeners&&this.listeners[i].slice().forEach(function(k){return h.callListener(k,c)}),!c||!c.defaultPrevented},l.prototype.callListener=function(i,c){"function"==typeof i?i.call(this,c):i.handleEvent.call(this,c)},l.prototype.debugLog=function(i){this.options.debug&&console.log(i)},l.prototype.getTooManyFailedReconnectsMessage=function(){var i=this.options.maxReconnectAttempts;return"Failed to reconnect after "+i+" "+function H(l,i){return 1===i?l:l+"s"}("attempt",i)+". Closing permanently."},l.DEFAULT_OPTIONS={allClearResetTime:5e3,connectTimeout:5e3,debug:!1,minReconnectDelay:1e3,maxReconnectDelay:3e4,maxReconnectAttempts:Number.POSITIVE_INFINITY,reconnectBackoffFactor:1.5,shouldReconnect:function(){return!0},wsConstructor:void 0},l.CONNECTING=0,l.OPEN=1,l.CLOSING=2,l.CLOSED=3,l}();function _(){}A.Z=B}}]);