"use strict";(self.webpackChunktetu_game_ui=self.webpackChunktetu_game_ui||[]).push([[589],{81589:(B,T,n)=>{n.r(T),n.d(T,{HeroLevelUpModule:()=>X});var d=n(35103),b=n(5476),U=n(16268),x=n(28230),m=n(82865),v=n(76291),f=n(41284),P=n(378),y=n(68305),M=n(56561),L=n(68351),_=n(97804),S=n(74107),H=n(43916),D=n(57563),C=n(35879),A=n(90654),u=n(90410),e=n(98678),r=n(90473),s=n(59937),l=n(53344),c=n(51216),h=n(11517),g=n(59634),O=n(43605),R=n(2097),F=n(54831);let Z=(()=>{class o{constructor(){this.down=new e.vpe,this.up=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-buttons-level-up"]],hostAttrs:[1,"g-flex","g-flex--align-center","g-flex--space-between"],inputs:{value:"value",valueLevel:"valueLevel",points:"points",valueName:"valueName"},outputs:{down:"down",up:"up"},decls:2,vars:4,consts:[["size","0",3,"isMinimal","isLeftDisabled","isRightDisabled","leftClick","rightClick"]],template:function(t,a){1&t&&(e.TgZ(0,"app-left-right-frame",0),e.NdJ("leftClick",function(){return a.down.emit(a.valueName)})("rightClick",function(){return a.up.emit(a.valueName)}),e._uU(1),e.qZA()),2&t&&(e.Q6J("isMinimal",!0)("isLeftDisabled",!(a.points<5&&a.valueLevel>0))("isRightDisabled",!(a.points>0)),e.xp6(1),e.hij(" ",a.value+a.valueLevel,"\n"))},dependencies:[F.y],changeDetection:0}),o})();var k=n(86237),I=n(46835),N=n(13252),w=n(96342);function G(o,p){1&o&&e._UZ(0,"app-loading-small",2)}function K(o,p){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"div",15)(2,"div",16)(3,"div",15),e._UZ(4,"img",17),e.qZA(),e._UZ(5,"img",18),e.qZA(),e._UZ(6,"div",19),e.TgZ(7,"div",20)(8,"div",21),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"div",22),e._uU(12),e.ALo(13,"translate"),e.qZA()()(),e.TgZ(14,"app-buttons-level-up",23),e.NdJ("down",function(i){e.CHM(t);const E=e.oxw(2);return e.KtG(E.changeStat(i,!1))})("up",function(i){e.CHM(t);const E=e.oxw(2);return e.KtG(E.changeStat(i,!0))}),e.qZA()()}if(2&o){const t=p.$implicit,a=e.oxw(2);let i;e.xp6(4),e.Q6J("src",t.icon,e.LSH),e.xp6(5),e.hij(" ",e.lcZ(10,7,t.name)," "),e.xp6(3),e.hij(" ",e.lcZ(13,9,null!==(i=t.description)&&void 0!==i?i:"")," "),e.xp6(2),e.Q6J("points",a.stats)("value",a.getHeroValueByKey(t.id))("valueLevel",a.coreStatsChange[t.id])("valueName",t.id)}}function $(o,p){if(1&o){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("hostClick",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.approve())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("isDisabled",t.waiting),e.xp6(1),e.hij(" ",e.lcZ(2,2,"hero-level-up.buttons.assign")," ")}}function Y(o,p){if(1&o){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("hostClick",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.levelUp())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("isNeedConfirm",!0)("infoDesc",t.isButtonLevelUpDisabled().reason)("isDisabled",t.isButtonLevelUpDisabled().status),e.xp6(1),e.hij(" ",e.lcZ(2,4,"hero-level-up.buttons.level-up")," ")}}function J(o,p){if(1&o){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("hostClick",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.buyTokens())}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"img",31),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("isNeedConfirm",!0)("isDisabled",t.waiting),e.xp6(1),e.hij(" ",e.lcZ(2,4,t.waiting?"hero-level-up.buttons.buying":"hero-level-up.buttons.buy")," "),e.xp6(2),e.Q6J("src","assets/images/ui/icons/tokens/"+t.fee.meta.name.toLowerCase()+".png",e.LSH)}}function j(o,p){if(1&o&&(e.ynx(0),e.TgZ(1,"div",26)(2,"div",27)(3,"div"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"app-balance",28),e.qZA(),e.YNc(7,J,4,6,"button",29),e.qZA(),e.BQk()),2&o){const t=e.oxw(2);e.xp6(4),e.hij(" ",e.lcZ(5,6,"hero-level-up.cost")," "),e.xp6(2),e.Q6J("isReverse",!1)("balance",t.needForLevelUpN())("isShowBalanceUsd",!0)("tokenType",t.fee.meta.name.toLowerCase()),e.xp6(1),e.Q6J("ngIf",!t.isEnoughBalance())}}function W(o,p){if(1&o){const t=e.EpF();e.TgZ(0,"div",3)(1,"div",4),e.YNc(2,K,15,11,"div",5),e.qZA(),e.TgZ(3,"div",6)(4,"div",7),e._uU(5),e.ALo(6,"translate"),e.TgZ(7,"span",8),e._uU(8),e.qZA()(),e.YNc(9,$,3,4,"button",9),e.YNc(10,Y,3,6,"button",10),e.TgZ(11,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.reset())}),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.YNc(14,j,8,8,"ng-container",12),e._UZ(15,"div",13),e.qZA()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",t.HERO_CORE_STATS),e.xp6(3),e.hij(" ",e.lcZ(6,7,"hero-level-up.available"),": "),e.xp6(3),e.Oqu(t.stats),e.xp6(1),e.Q6J("ngIf",!!t.fee&&t.fee.accountBalance!==t.ZERO_BI&&t.fee.allowance<t.needForLevelUp()),e.xp6(1),e.Q6J("ngIf",!(t.fee&&t.fee.accountBalance!==t.ZERO_BI&&t.fee.allowance<t.needForLevelUp())),e.xp6(2),e.hij(" ",e.lcZ(13,9,"hero-level-up.buttons.reset")," "),e.xp6(2),e.Q6J("ngIf",!!t.fee)}}const Q=[{path:v.EX.EMPTY,component:(()=>{class o{constructor(t,a,i,E,V,q,ee,te,ne,oe,ae,re){this.router=t,this.activatedRoute=a,this.destroy$=i,this.heroControllerService=E,this.heroDataService=V,this.changeDetectorRef=q,this.tokenService=ee,this.subgraphService=te,this.providerService=ne,this.appStateService=oe,this.soundService=ae,this.mediator=re,this.ZERO_BI=0n,this.loading=!0,this.stats=5,this.waiting=!1,this.HERO_CORE_STATS=_.nW,this.coreStatsChange={strength:0,dexterity:0,vitality:0,energy:0},this.heroAdr=this.activatedRoute.snapshot.paramMap.get(v.xu)??"",this.heroId=Number(this.activatedRoute.snapshot.paramMap.get(v.B$)??0),this.appStateService.setHeaderState({isInventoryShown:!0,backUrl:[v.EX.HERO,this.heroAdr,this.heroId.toString()]})}ngOnInit(){this.providerService.subscribeOnAccountAndNetwork(this.destroy$,this.changeDetectorRef,t=>{this.account=t,this.init()},t=>{this.chainId=t,this.heroControllerService.adjustFees(t),this.tokenService.adjustFees(t),this.init()})}init(){this.account&&this.chainId&&this.loadHeroModel()}loadHeroModel(){this.subgraphService.hero$(this.heroAdr,this.heroId).pipe((0,C.R)(this.destroy$)).subscribe(t=>{this.hero=t,this.fee=new f._(new P.Z(t.meta.feeToken.token.id,t.meta.feeToken.token.symbol,t.meta.feeToken.token.decimals),(0,D.vz)(t.meta.feeToken.amount,t.meta.feeToken.token.decimals)),this.loading=!1,this.refreshFeeTokenData()})}refreshFeeTokenData(){(0,A.D)([this.tokenService.balanceOf$(this.fee.meta.tokenAdr,this.account),this.tokenService.allowance$(this.fee.meta.tokenAdr,this.account,(0,L.wA)(this.chainId).heroTokensVault)]).pipe((0,C.R)(this.destroy$)).subscribe(([t,a])=>{this.fee.accountBalance=t,this.fee.allowance=a,this.changeDetectorRef.detectChanges(),this.mediator.dispatch(new M.N.PageLoaded(v.EX.INVENTORY))})}changeStat(t,a){a?this.coreStatsChange[t]++:this.coreStatsChange[t]--,a?this.stats--:this.stats++}reset(){this.coreStatsChange={strength:0,dexterity:0,vitality:0,energy:0},this.stats=5}needForLevelUp(){return this.fee.amount*BigInt(this.hero.stats.level+1)}needForLevelUpN(){return D.bM(this.needForLevelUp(),this.fee.meta.decimals)}getHeroValueByKey(t){return(0,H.s4)(this.hero.core,t)}isEnoughBalance(){const t=(0,L.wA)(this.chainId);return(this.tokenService.tokenBalanceCache.get(t.gameToken)??0n)>=this.needForLevelUp()}approve(){this.waiting=!0,this.changeDetectorRef.detectChanges(),this.tokenService.approve$(this.account,this.fee.meta.tokenAdr,(0,L.wA)(this.chainId).heroTokensVault,BigInt(S.k.MAX_UINT)).pipe((0,C.R)(this.destroy$)).subscribe(()=>{this.waiting=!1,this.loadHeroModel(),this.changeDetectorRef.detectChanges()})}buyTokens(){this.waiting=!0,this.changeDetectorRef.detectChanges(),this.tokenService.buyTokens$(this.account,"",this.fee.meta.tokenAdr,this.needForLevelUp(),this.chainId).pipe((0,u.x)(()=>{this.waiting=!1,this.changeDetectorRef.detectChanges()}),(0,C.R)(this.destroy$)).subscribe(()=>{this.loadHeroModel(),this.changeDetectorRef.detectChanges()})}levelUp(){this.waiting=!0,this.changeDetectorRef.detectChanges(),this.soundService.play({key:"level_up"}),this.heroControllerService.levelUp$(this.account,this.chainId,this.hero.meta.id,this.hero.heroId,this.coreStatsChange).pipe((0,u.x)(()=>{this.waiting=!1,this.changeDetectorRef.detectChanges()}),(0,C.R)(this.destroy$)).subscribe(()=>{this.router.navigate([v.EX.HERO,this.hero.meta.id,this.hero.heroId.toString()])})}isButtonLevelUpDisabled(){return this.waiting?{reason:"Wait for transaction result",status:!0}:this.fee.accountBalance<this.needForLevelUp()?{reason:"Not enough tokens",status:!0}:this.fee.allowance<this.needForLevelUp()?{reason:"Not enough allowance",status:!0}:0!==this.stats?{reason:"Use all available attributes points",status:!0}:this.hero.dungeon?{reason:"Hero in dungeon can not level up",status:!0}:this.hero.staked?{reason:"Staked hero can not level up",status:!0}:{reason:"",status:!1}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(U.F0),e.Y36(U.gz),e.Y36(y.z),e.Y36(r.r),e.Y36(s.G),e.Y36(e.sBO),e.Y36(l.B),e.Y36(c.k),e.Y36(h.H),e.Y36(g.Z),e.Y36(O.y),e.Y36(R._))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-hero-level-up"]],hostAttrs:[1,"g-flex-column"],features:[e._Bn([y.z])],decls:3,vars:2,consts:[["class","page-loader",4,"ngIf","ngIfElse"],["contentTpl",""],[1,"page-loader"],[1,"container"],[1,"stat-container"],["class","element g-flex g-flex--align-center g-flex--space-between",4,"ngFor","ngForOf"],[1,"actions","g-flex","g-flex--align-center","g-flex--space-between"],[1,"available"],[1,"available__value"],["class","btn-level-up app-btn-blue-3","appButtonClick","",3,"isDisabled","hostClick",4,"ngIf"],["class","btn-level-up app-btn-red-3","appButtonClick","",3,"isNeedConfirm","infoDesc","isDisabled","hostClick",4,"ngIf"],[1,"btn-reset","app-btn-blue-1-2",3,"click"],[4,"ngIf"],[1,"background"],[1,"element","g-flex","g-flex--align-center","g-flex--space-between"],[1,"g-flex","g-flex--align-center"],[1,"element__container","g-flex-column","g-flex--align-center"],["alt","",1,"element__img",3,"src"],["src","assets/images/ui/dividers/borders_v/border_v_up.png","alt","",1,"element__top-border"],[1,"app-divider-group-of-bolts"],[1,"element__title","g-flex-column"],[1,"element__title-name","app-btn_font-size"],[1,"element__title-desc","app-btn-small_font-size"],[1,"buttons-level-up",3,"points","value","valueLevel","valueName","down","up"],["appButtonClick","",1,"btn-level-up","app-btn-blue-3",3,"isDisabled","hostClick"],["appButtonClick","",1,"btn-level-up","app-btn-red-3",3,"isNeedConfirm","infoDesc","isDisabled","hostClick"],[1,"balance","g-flex-column","g-flex--align-center","gap-24"],[1,"info","g-flex","g-flex--align-center","g-flex--justify-center","gap-12"],[3,"isReverse","balance","isShowBalanceUsd","tokenType"],["class","btn-buy app-btn-silver-3 g-flex g-flex--align-center g-flex--justify-center","appButtonClick","",3,"isNeedConfirm","isDisabled","hostClick",4,"ngIf"],["appButtonClick","",1,"btn-buy","app-btn-silver-3","g-flex","g-flex--align-center","g-flex--justify-center",3,"isNeedConfirm","isDisabled","hostClick"],["alt","",1,"btn-buy__icon","shadow__icon",3,"src"]],template:function(t,a){if(1&t&&(e.YNc(0,G,1,0,"app-loading-small",0),e.YNc(1,W,16,11,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",a.loading||!a.hero)("ngIfElse",i)}},dependencies:[d.sg,d.O5,Z,k.B,I.T,N.Y,w.X$],styles:[".shadow__button[_ngcontent-%COMP%]{filter:drop-shadow(12px 15px 10px rgba(0,0,0,.15)) drop-shadow(0 0 15px rgba(0,0,0,.2))}.shadow__icon[_ngcontent-%COMP%], .element__img[_ngcontent-%COMP%], .icon__gold[_ngcontent-%COMP%]{filter:drop-shadow(0px 3px 2px rgba(0,0,0,.4)) drop-shadow(0 0 15px rgba(0,0,0,.2))}.color-enemy-name[_ngcontent-%COMP%]{color:#e03636}.color-negative-value[_ngcontent-%COMP%]{color:#dd6363}.color-positive-value[_ngcontent-%COMP%]{color:#a6a6a6}.color-mana[_ngcontent-%COMP%]{color:#8282f6}.color-red-fire[_ngcontent-%COMP%]{color:#dc3e3e}.color-yellow-fire[_ngcontent-%COMP%]{color:#dfa94e}.color-nickname[_ngcontent-%COMP%]{color:#d7a061}.color-caption[_ngcontent-%COMP%]{color:#a37c83}.bar-hp[_ngcontent-%COMP%]{color:#9af481}.bar-mp[_ngcontent-%COMP%]{color:#8282f6}.bar-exp[_ngcontent-%COMP%]{color:#ffda82}.bar-enemy[_ngcontent-%COMP%]{color:#fb9696}.color-try[_ngcontent-%COMP%]{color:#d8ffd4}.color-free[_ngcontent-%COMP%]{color:#f9fff5}.container[_ngcontent-%COMP%]{position:relative;padding-top:20px}.stat-container[_ngcontent-%COMP%]{position:relative;z-index:1;padding-top:120px}.background[_ngcontent-%COMP%]{position:absolute;width:100%;height:1011px;top:0;background-image:url(/assets/images/ui/background-lists/level-up-page/back.avif);background-repeat:no-repeat;background-size:100%}.available__value[_ngcontent-%COMP%]{margin-left:5px;color:#dfa94e;text-shadow:0 0 16px #dfa94e}.btn-create[_ngcontent-%COMP%]{text-align:center;padding:20px}.btn-buy[_ngcontent-%COMP%]{align-self:center;margin-left:30px;z-index:1}.btn-buy__icon[_ngcontent-%COMP%]{margin-left:10px}.element[_ngcontent-%COMP%]{height:175px;padding:0 60px 60px;margin-bottom:-20px;z-index:2}.element__top-border[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:-20px}.element__img[_ngcontent-%COMP%]{width:55px;height:57px;margin:0 10px}.element__title[_ngcontent-%COMP%]{gap:15px;margin-left:20px;text-transform:capitalize}.btn-level-up[_ngcontent-%COMP%], .btn-reset[_ngcontent-%COMP%]{z-index:1}.actions[_ngcontent-%COMP%]{position:relative;padding:0 67px 0 75px;margin-top:20px;z-index:4}.info[_ngcontent-%COMP%]{position:relative;margin-top:10px;z-index:4}.balance[_ngcontent-%COMP%]{margin:120px 68px 0 73px}.balance__cost[_ngcontent-%COMP%]{color:#dfa94e;text-shadow:0 0 16px #dfa94e}.icon__gold[_ngcontent-%COMP%]{margin-left:10px}.app-divider-group-of-bolts[_ngcontent-%COMP%]{margin:0 14px}.buttons-level-up[_ngcontent-%COMP%]{margin-right:-20px}"],changeDetection:0}),o})(),data:{animation:"HeroLevelUpComponent"}}];let X=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[d.ez,U.Bz.forChild(Q),b.u5,m.m,x.r]}),o})()},90473:(B,T,n)=>{n.d(T,{r:()=>A});var d=n(80557),b=n(25658),U=n(68351),x=n(43916),m=n(14111),v=n(2677),f=n(9249),P=n(21160),y=n(69637),M=n(27193),L=n(17978),_=n(98678),S=n(11517),H=n(55298),D=n(30611),C=n(46693);let A=(()=>{class u extends b.kP{constructor(r,s,l,c){super(),this.providerService=r,this.errorService=s,this.logger=l,this.relayService=c}createHeroController(r,s=""){return L.x8.connect((0,U.wA)(r).heroController,this.providerService.getProviderForRead())}nameToHero$(r,s){return this.logger.trace("nameToHero",r,s),(0,m.D)(this.createHeroController(s).nameToHero(r)).pipe((0,v.X)({count:b.S8,delay:b.V1}),(0,f.K)(this.errorService.onCatchError))}askReinforcement$(r,s,l,c){return(0,m.D)(this.createHeroController(s,r).askReinforcement.estimateGas(l,c)).pipe((0,P.w)(h=>this.updateCurrentFees$(this.providerService,h)),(0,y.z)(h=>this.providerService.onChainCall(new d.bq({name:"Ask reinforcement",showLoadingScreen:!0,isNeedUpdateHero:!0,txPopulated:this.createHeroController(s,r).askReinforcement.populateTransaction(l,c),gasLimit:(0,x.gu)(h),maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas,gasPrice:this.gasPrice,isDelegatedRelayPossible:!0,relayService:this.relayService}))),(0,f.K)(this.errorService.onCatchError))}levelUp$(r,s,l,c,h){return(0,m.D)(this.createHeroController(s,r).levelUp.estimateGas(l,c,h)).pipe((0,P.w)(g=>this.updateCurrentFees$(this.providerService,g)),(0,M.b)(g=>this.providerService.onChainCall(new d.bq({name:"Level up",isNeedUpdateHero:!0,isNeedUpdateBalances:!0,txPopulated:this.createHeroController(s,r).levelUp.populateTransaction(l,c,h),gasLimit:(0,x.gu)(g),maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas,gasPrice:this.gasPrice,isDelegatedRelayPossible:!0,relayService:this.relayService}))),(0,f.K)(this.errorService.onCatchError))}create$(r,s,l,c,h,g=!0){return(0,m.D)(this.createHeroController(s,r).createWithRefCode.estimateGas(l,c,h.toLowerCase(),g)).pipe((0,P.w)(O=>this.updateCurrentFees$(this.providerService,O)),(0,M.b)(O=>this.providerService.onChainCall(new d.bq({name:"Create hero",isNeedUpdateHero:!0,isNeedUpdateBalances:!0,txPopulated:this.createHeroController(s,r).createWithRefCode.populateTransaction(l,c,h,g),gasLimit:(0,x.gu)(O),maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas,gasPrice:this.gasPrice,isDelegatedRelayPossible:!0,relayService:this.relayService}))),(0,f.K)(this.errorService.onCatchError))}setBiome$(r,s,l,c,h){return(0,m.D)(this.createHeroController(s,r).setBiome.estimateGas(l,c,h)).pipe((0,P.w)(g=>this.updateCurrentFees$(this.providerService,g)),(0,M.b)(g=>this.providerService.onChainCall(new d.bq({name:"Set biome",txPopulated:this.createHeroController(s,r).setBiome.populateTransaction(l,c,h),gasLimit:(0,x.gu)(g),maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas,gasPrice:this.gasPrice,isDelegatedRelayPossible:!0,relayService:this.relayService}))),(0,f.K)(this.errorService.onCatchError))}}return u.\u0275fac=function(r){return new(r||u)(_.LFG(S.H),_.LFG(H.T),_.LFG(D.Kf),_.LFG(C.D))},u.\u0275prov=_.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);